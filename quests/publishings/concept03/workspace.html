<!DOCTYPE html>
<html lang="ko" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 노블 메이커 - 워크스페이스</title>
    <!-- Bootstrap 5.3 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="style.css">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>

    <div id="navbar-placeholder"></div>

    <div class="container mt-4">
        <!-- Tab Navigation (Nav Pills/Tabs) -->
        <ul class="nav nav-tabs mb-3 workspace-tabs" id="workspaceTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings-pane" type="button" role="tab" aria-controls="settings-pane" aria-selected="true">설정</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="agents-tab" data-bs-toggle="tab" data-bs-target="#agents-pane" type="button" role="tab" aria-controls="agents-pane" aria-selected="false">에이전트 라이브러리</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="orchestra-tab" data-bs-toggle="tab" data-bs-target="#orchestra-pane" type="button" role="tab" aria-controls="orchestra-pane" aria-selected="false">오케스트라 캔버스</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="outputs-tab" data-bs-toggle="tab" data-bs-target="#outputs-pane" type="button" role="tab" aria-controls="outputs-pane" aria-selected="false">결과물</button>
            </li>
        </ul>

        <!-- Tab Content -->
        <div class="tab-content" id="workspaceTabsContent">
            <!-- New Settings Tab Pane (IA 3.0) -->
            <div class="tab-pane fade show active p-3 border rounded bg-body-tertiary" id="settings-pane" role="tabpanel" aria-labelledby="settings-tab" tabindex="0">
                <div class="row">
                    <!-- Nested Tab Navigation (col-md-3) -->
                    <div class="col-md-3">
                        <div class="d-flex flex-column p-3 bg-body-tertiary rounded border settings-nav">
                            <h5 class="mb-3">프로젝트 설정</h5>
                            <nav class="nav nav-pills flex-column">
                                <a class="nav-link active" id="basic-settings-tab" data-bs-toggle="pill" href="#basic-settings-pane" role="tab" aria-controls="basic-settings-pane" aria-selected="true">기본 설정</a>
                                <a class="nav-link" id="ai-model-tab" data-bs-toggle="pill" href="#ai-model-pane" role="tab" aria-controls="ai-model-pane" aria-selected="false">AI 모델 설정</a>
                                <a class="nav-link" id="data-management-tab" data-bs-toggle="pill" href="#data-management-pane" role="tab" aria-controls="data-management-pane" aria-selected="false">데이터 관리</a>
                                <a class="nav-link" id="characters-tab" data-bs-toggle="pill" href="#characters-pane" role="tab" aria-controls="characters-pane" aria-selected="false">인물</a>
                            </nav>
                        </div>
                    </div>

                    <!-- Nested Tab Content (col-md-9) -->
                    <div class="col-md-9">
                        <div class="tab-content p-4 bg-body-tertiary rounded border">
                            <!-- Basic Settings Pane (IA 2.1) -->
                            <div class="tab-pane fade show active" id="basic-settings-pane" role="tabpanel" aria-labelledby="basic-settings-tab">
                                <h4>기본 설정</h4>
                                <form class="mt-3">
                                    <div class="mb-3">
                                        <label for="projectTitle" class="form-label">프로젝트 제목</label>
                                        <input type="text" class="form-control" id="projectTitle" value="프로젝트 A">
                                    </div>
                                    <div class="mb-3">
                                        <label for="projectGenre" class="form-label">핵심 장르</label>
                                        <select class="form-select" id="projectGenre">
                                            <option value="fantasy" selected>판타지</option>
                                            <option value="romance">로맨스</option>
                                            <option value="sf">SF</option>
                                            <option value="mystery">미스터리</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="projectLogline" class="form-label">로그라인 (한 줄 요약)</label>
                                        <textarea class="form-control" id="projectLogline" rows="2">몰락한 가문의 마지막 생존자가 복수를 위해 금지된 마법을 배우는 이야기</textarea>
                                    </div>
                                    <button type="submit" class="btn btn-primary">변경 사항 저장</button>
                                </form>
                            </div>

                            <!-- AI Model Settings Pane (IA 2.2) -->
                            <div class="tab-pane fade p-3 border rounded bg-body-tertiary" id="ai-model-pane" role="tabpanel" aria-labelledby="ai-model-tab">
                                <h4>AI 모델 설정</h4>
                                <form class="mt-3">
                                    <div class="mb-3">
                                        <label for="aiModel" class="form-label">사용할 AI 모델</label>
                                        <select class="form-select" id="aiModel">
                                            <option value="gemini-1.5-pro" selected>Gemini 1.5 Pro</option>
                                            <option value="gemini-1.0-pro">Gemini 1.0 Pro</option>
                                            <option value="gpt-4o">GPT-4o</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="temperature" class="form-label">창의성 (Temperature)</label>
                                        <input type="range" class="form-range" id="temperature" min="0" max="1" step="0.1" value="0.7">
                                        <div class="d-flex justify-content-between">
                                            <span>보수적</span>
                                            <span>창의적</span>
                                        </div>
                                    </div>
                                    <button type="submit" class="btn btn-primary">변경 사항 저장</button>
                                </form>
                            </div>

                            <!-- Data Management Pane (IA 2.3) -->
                            <div class="tab-pane fade" id="data-management-pane" role="tabpanel" aria-labelledby="data-management-tab">
                                <h4>데이터 관리</h4>
                                <div class="mt-3">
                                    <button class="btn btn-secondary me-2">프로젝트 데이터 내보내기</button>
                                    <button class="btn btn-secondary">프로젝트 데이터 가져오기</button>
                                </div>
                                <div class="card border-danger bg-dark-subtle mt-5">
                                    <div class="card-body">
                                        <h5 class="card-title text-danger">Danger Zone</h5>
                                        <p class="card-text">프로젝트를 삭제하면 모든 데이터가 영구 삭제되며 복구할 수 없습니다.</p>
                                        <button class="btn btn-danger">프로젝트 삭제</button>
                                    </div>
                                </div>
                            </div>

                            <!-- Characters Pane (IA 2.4) -->
                            <div class="tab-pane fade" id="characters-pane" role="tabpanel" aria-labelledby="characters-tab">
                                <h4>인물</h4>
                                <button class="btn btn-primary mb-3">
                                    <i class="bi bi-plus-lg me-2"></i>새 인물 추가
                                </button>
                                <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                                    <!-- Character Card 1 -->
                                    <div class="col">
                                        <div class="card character-card h-100">
                                            <img src="https://placehold.co/600x400/FFD700/white?text=엘라라" class="card-img-top" alt="엘라라">
                                            <div class="card-body">
                                                <h5 class="card-title">엘라라 (Elara)</h5>
                                                <p class="card-text small text-muted">주인공, 몰락한 왕국의 마지막 공주</p>
                                            </div>
                                            <div class="card-footer text-end">
                                                <button class="btn btn-sm btn-outline-secondary">편집</button>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Character Card 2 -->
                                    <div class="col">
                                        <div class="card character-card h-100">
                                            <img src="https://placehold.co/600x400/8A2BE2/white?text=카이로스" class="card-img-top" alt="카이로스">
                                            <div class="card-body">
                                                <h5 class="card-title">카이로스 (Kairos)</h5>
                                                <p class="card-text small text-muted">조력자, 신비로운 마법사</p>
                                            </div>
                                            <div class="card-footer text-end">
                                                <button class="btn btn-sm btn-outline-secondary">편집</button>
                                            </div>
                                        </div>
                                    </div>
                                    <!-- Character Card 3 -->
                                    <div class="col">
                                        <div class="card character-card h-100">
                                            <img src="https://placehold.co/600x400/DC143C/white?text=제이든" class="card-img-top" alt="제이든">
                                            <div class="card-body">
                                                <h5 class="card-title">제이든 (Jayden)</h5>
                                                <p class="card-text small text-muted">적대자, 제국군 사령관</p>
                                            </div>
                                            <div class="card-footer text-end">
                                                <button class="btn btn-sm btn-outline-secondary">편집</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Agents Tab Pane (IA 3.1) -->
            <div class="tab-pane fade p-3 border rounded bg-body-tertiary" id="agents-pane" role="tabpanel" aria-labelledby="agents-tab" tabindex="0">
                <button class="btn btn-primary mb-3" id="new-agent-btn" data-bs-toggle="modal" data-bs-target="#templateLibraryModal">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-plus-lg me-2" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2"/>
                    </svg>
                    새 에이전트 생성
                </button>
                <div class="card bg-dark-subtle">
                    <div class="card-body">
                        <h5 class="card-title">에이전트 1: 세계관 설정 도우미</h5>
                        <p class="card-text text-muted">소설의 배경, 역사, 문화 등 세계관을 구축하는 데 도움을 줍니다.</p>
                    </div>
                </div>
            </div>

            <!-- (v1.7) '오케스트라' 탭 콘텐츠 (IA 3.2) - 기존 내용 덮어쓰기 -->
            <div class="tab-pane fade p-3 border rounded bg-body-tertiary" id="orchestra-pane" role="tabpanel">

              <!-- (IA 1.0) 캔버스 2-단 레이아웃 -->
              <div class="orchestra-layout">

                <!-- (IA 1.3) 좌측 에이전트 사이드바 -->
                <div class="agent-sidebar">
                  <h6><i class="bi bi-people-fill"></i> 에이전트 라이브러리</h6>
                  <p class="small text-muted">에이전트를 캔버스로 드래그하세요.</p>
                  
                  <!-- (v1.7) 드래그 가능한 에이전트 카드 (JS에서 감지) -->
                  <div class="agent-card" data-agent-name="1. 세계관 설정">
                    <i class="bi bi-globe2"></i> 1. 세계관 설정
                  </div>
                  <div class="agent-card" data-agent-name="2. 플롯 생성기">
                    <i class="bi bi-pencil-square"></i> 2. 플롯 생성기
                  </div>
                  <div class="agent-card" data-agent-name="3. 챕터 집필가">
                    <i class="bi bi-book-fill"></i> 3. 챕터 집필가
                  </div>
                </div>

                <!-- (IA 1.4) 메인 캔버스 -->
                <div class="canvas-main" id="orchestra-canvas">

                  <!-- (IA 1.6) 캔버스 툴바 -->
                  <div class="canvas-toolbar">
                    <button class="btn btn-secondary" id="btn-save-workflow">
                      <i class="bi bi-cloud-arrow-up-fill"></i> 워크플로우 저장
                    </button>
                    <button class="btn btn-primary" id="btn-run-workflow">
                      <i class="bi bi-play-fill"></i> 워크플로우 실행
                    </button>
                  </div>

                  <!-- (IA 4.1) 캔버스 힌트 텍스트 -->
                  <div id="canvas-hint" class="text-center text-muted" style="padding-top: 20vh; user-select: none;">
                    <h3>오케스트라 캔버스</h3>
                    <p>왼쪽 사이드바에서 에이전트를 드래그하여 워크플로우를 시작하세요.</p>
                  </div>

                  <!-- (IA 1.5) 노드(Node)가 이곳에 JS로 동적 추가됩니다. (예시) -->
                  <!--
                  <div class="node" style="top: 50px; left: 100px;">
                    <h5><i class="bi bi-globe2"></i> 1. 세계관 설정</h5>
                  </div>
                  -->
                </div>

              </div>
            </div>

            <!-- Outputs Tab Pane (IA 3.3) -->
            <div class="tab-pane fade p-3 border rounded bg-body-tertiary" id="outputs-pane" role="tabpanel" aria-labelledby="outputs-tab" tabindex="0">
                <div id="outputs-free-view" class="text-center py-5">
                    <h4 class="text-muted">생성된 결과물이 이곳에 표시됩니다.</h4>
                    <p class="text-muted">AI 에이전트들이 생성한 소설 초안, 캐릭터 설정, 이미지 등을 확인하세요.</p>
                </div>
                <div id="outputs-pro-view" class="d-none">
                    <h4>생성된 결과물 (Pro Sample)</h4>
                    <ul class="list-group mt-3">
                        <li class="list-group-item bg-dark-subtle d-flex justify-content-between align-items-center">
                            <span class="text-truncate">챕터 1 초안 - "새로운 시작"</span>
                            <span class="badge bg-info rounded-pill">소설</span>
                        </li>
                        <li class="list-group-item bg-dark-subtle d-flex justify-content-between align-items-center">
                            <span class="text-truncate">주인공 '엘라라' 캐릭터 설정</span>
                            <span class="badge bg-success rounded-pill">캐릭터</span>
                        </li>
                        <li class="list-group-item bg-dark-subtle d-flex justify-content-between align-items-center">
                            <span class="text-truncate">판타지 세계관 지도 (초안)</span>
                            <span class="badge bg-warning text-dark rounded-pill">이미지</span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

    </div>

    <!-- Modals -->
    <!-- Template Library Modal (IA 2.0) -->
    <div class="modal fade" id="templateLibraryModal" tabindex="-1" aria-labelledby="templateLibraryModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="templateLibraryModalLabel">새 에이전트 생성 - 템플릿 선택</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted">원하는 템플릿을 선택하여 AI 에이전트를 생성하거나, 빈 캔버스에서 직접 만드세요.</p>
                    <div class="row row-cols-1 row-cols-md-2 g-3 mt-3">
                        <!-- Basic Template -->
                        <div class="col">
                            <div class="card h-100 bg-dark-subtle template-card" data-template-type="basic">
                                <div class="card-body">
                                    <h5 class="card-title">세계관 설정 도우미 (Basic)</h5>
                                    <p class="card-text text-muted">소설의 배경, 역사, 문화 등 세계관을 구축하는 데 도움을 줍니다.</p>
                                    <span class="badge bg-success">Free</span>
                                </div>
                                <div class="card-footer">
                                    <button class="btn btn-sm btn-primary create-template-btn">선택</button>
                                </div>
                            </div>
                        </div>
                        <!-- Pro Template 1 -->
                        <div class="col">
                            <div class="card h-100 bg-dark-subtle template-card" data-template-type="pro">
                                <div class="card-body">
                                    <h5 class="card-title">플롯 구성 전문가 (Pro)</h5>
                                    <p class="card-text text-muted">복잡한 플롯 구조를 제안하고, 스토리라인을 구성합니다.</p>
                                    <span class="badge bg-warning text-dark">Pro</span>
                                </div>
                                <div class="card-footer">
                                    <button class="btn btn-sm btn-secondary create-template-btn">선택</button>
                                </div>
                            </div>
                        </div>
                        <!-- Pro Template 2 -->
                        <div class="col">
                            <div class="card h-100 bg-dark-subtle template-card" data-template-type="pro">
                                <div class="card-body">
                                    <h5 class="card-title">캐릭터 심층 분석가 (Pro)</h5>
                                    <p class="card-text text-muted">주요 인물의 성격, 배경, 관계를 심층적으로 분석하고 발전시킵니다.</p>
                                    <span class="badge bg-warning text-dark">Pro</span>
                                </div>
                                <div class="card-footer">
                                    <button class="btn btn-sm btn-secondary create-template-btn">선택</button>
                                </div>
                            </div>
                        </div>
                        <!-- Blank Canvas -->
                        <div class="col">
                            <div class="card h-100 bg-dark-subtle template-card" data-template-type="blank">
                                <div class="card-body">
                                    <h5 class="card-title">빈 캔버스에서 시작하기</h5>
                                    <p class="card-text text-muted">나만의 AI 에이전트를 처음부터 직접 설계합니다.</p>
                                    <span class="badge bg-info">Custom</span>
                                </div>
                                <div class="card-footer">
                                    <button class="btn btn-sm btn-primary create-template-btn">선택</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Paywall Modal (Reused from app.js dynamic insertion) -->
    <!-- This modal will be dynamically inserted by app.js if needed -->

    <!-- Bootstrap 5.3 JS (with Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js" integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy" crossorigin="anonymous"></script>
    <!-- Custom JavaScript -->
    <script src="global-nav.js"></script>
    <script src="app.js"></script>
    <script src="orchestra.js" defer></script>
    <script src="character.js" defer></script>
</body>
</html>
